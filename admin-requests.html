<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Requests - GovEx Academy</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // Icon component
        function Icon({ name, size = 16, className = "", ...props }) {
            const LucideIcon = lucide[name.charAt(0).toUpperCase() + name.slice(1).replace(/-([a-z])/g, (g) => g[1].toUpperCase())];
            if (!LucideIcon) {
                return <span className={`inline-block w-4 h-4 ${className}`} {...props} />;
            }
            return React.createElement(LucideIcon, { size, className, ...props });
        }

        // Google Sheets Service
        const GoogleSheetsService = {
            API_KEY: 'AIzaSyB2gKfKdxFq-jyaAbhFBj0-PxQ4y_tBIJA',
            SHEET_ID: '1GSqiViIPp4GPAe4ugZ2ImXShsU1NP37CjT_I3Ck-AR4',

            async fetchFormResponses() {
                const RANGE = 'Form Responses 1!A2:K';
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${this.SHEET_ID}/values/${RANGE}?key=${this.API_KEY}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();

                    if (!data.values) {
                        return [];
                    }

                    return data.values.map((row, index) => {
                        const [
                            timestamp = '',
                            requesterName = '',
                            email = '',
                            topic = '',
                            description = '',
                            purpose = '',
                            targetAudience = '',
                            deadline = '',
                            languages = '',
                            urgencyLevel = '',
                            additionalContext = ''
                        ] = row;

                        return {
                            id: index + 1,
                            timestamp,
                            requesterName,
                            email,
                            topic,
                            description,
                            purpose,
                            targetAudience,
                            deadline,
                            languages,
                            urgencyLevel,
                            additionalContext,
                            status: 'doing'
                        };
                    });
                } catch (error) {
                    console.error('Error fetching form responses:', error);
                    return [];
                }
            }
        };

        function AdminRequestsApp() {
            const [requests, setRequests] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        setIsLoading(true);
                        const data = await GoogleSheetsService.fetchFormResponses();
                        setRequests(data);
                        setError(null);
                    } catch (err) {
                        setError('Failed to load data from Google Sheets');
                        console.error(err);
                    } finally {
                        setIsLoading(false);
                    }
                };

                loadData();
            }, []);

            const updateStatus = (requestId, newStatus) => {
                setRequests(prev => prev.map(req =>
                    req.id === requestId ? { ...req, status: newStatus } : req
                ));
            };

            if (isLoading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                            <h3 className="text-lg font-medium mb-2">Loading Requests</h3>
                            <p className="text-gray-400">Fetching data from Google Sheets...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-red-400 mb-4">
                                <Icon name="alert-circle" size={48} className="mx-auto" />
                            </div>
                            <h3 className="text-lg font-medium mb-2">Error Loading Data</h3>
                            <p className="text-gray-400 mb-4">{error}</p>
                            <button
                                onClick={() => window.location.reload()}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                Retry
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-900">
                    {/* Header */}
                    <header className="bg-gray-800 border-b border-gray-700 px-6 py-4">
                        <div className="flex items-center space-x-4">
                            <button
                                onClick={() => window.location.href = './index.html'}
                                className="flex items-center space-x-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors"
                            >
                                <Icon name="arrow-left" size={16} />
                                <span>Back to Dashboard</span>
                            </button>
                            <div>
                                <h1 className="text-xl font-bold text-white">Admin Requests</h1>
                                <p className="text-sm text-gray-400">Manage resource requests from Google Forms</p>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="p-6">
                        <div className="mb-6">
                            <h2 className="text-2xl font-semibold text-white mb-2">Resource Requests</h2>
                            <p className="text-gray-400">
                                Showing {requests.length} requests from Google Forms
                            </p>
                        </div>

                        {requests.length === 0 ? (
                            <div className="text-center py-12 bg-gray-800 rounded-lg border border-gray-700">
                                <Icon name="inbox" className="mx-auto text-gray-400 mb-4" size={48} />
                                <h3 className="text-lg font-medium text-white mb-2">No requests found</h3>
                                <p className="text-gray-400">New requests will appear here when submitted</p>
                            </div>
                        ) : (
                            <div className="bg-gray-800 border border-gray-700 rounded-lg overflow-hidden">
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-700 border-b border-gray-600">
                                            <tr>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Timestamp</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Name</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Email</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Topic</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Description</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Purpose</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Audience</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Deadline</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Languages</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Urgency</th>
                                                <th className="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase">Context</th>
                                                <th className="px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-600">
                                            {requests.map((request) => (
                                                <tr key={request.id} className="hover:bg-gray-700 transition-colors">
                                                    <td className="px-4 py-3 text-sm text-white">
                                                        {request.timestamp ? new Date(request.timestamp).toLocaleDateString() : 'N/A'}
                                                    </td>
                                                    <td className="px-4 py-3 text-sm text-white">{request.requesterName || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white">{request.email || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white">{request.topic || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white max-w-xs truncate">{request.description || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white max-w-xs truncate">{request.purpose || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white">{request.targetAudience || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white">{request.deadline || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white">{request.languages || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white">{request.urgencyLevel || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-sm text-white max-w-xs truncate">{request.additionalContext || 'N/A'}</td>
                                                    <td className="px-4 py-3 text-right">
                                                        <div className="flex flex-col items-end gap-2">
                                                            {/* Status Toggle */}
                                                            <button
                                                                onClick={() => updateStatus(request.id, request.status === 'doing' ? 'done' : 'doing')}
                                                                className={`px-3 py-1 rounded-full text-xs font-medium transition-colors ${
                                                                    request.status === 'done'
                                                                        ? 'bg-green-600 text-white'
                                                                        : 'bg-yellow-600 text-white'
                                                                }`}
                                                            >
                                                                {request.status === 'done' ? 'Done' : 'Doing'}
                                                            </button>

                                                            {/* Submit Resource Button */}
                                                            <button
                                                                onClick={() => {
                                                                    const url = prompt('Enter final resource URL:');
                                                                    if (url) {
                                                                        updateStatus(request.id, 'done');
                                                                        alert('Resource submitted successfully!');
                                                                    }
                                                                }}
                                                                className="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs transition-colors"
                                                            >
                                                                Submit Resource
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        // Render the app
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(AdminRequestsApp));
    </script>
</body>
</html>